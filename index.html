<!DOCTYPE html>
<html>
<head>
  <title>Meteor Madness ‚Äî NASA Data Demo</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    body{margin:0;font-family:sans-serif;background:#0b1220;color:white;
         display:grid;grid-template-columns:360px 1fr;height:100vh}
    aside{background:#121a2a;padding:14px;overflow:auto}
    h2{margin:0 0 10px}
    label{font-size:12px;color:#8aa0b6;display:block;margin:6px 0}
    input,select,button{width:100%;padding:8px;margin-bottom:8px;border-radius:6px;border:none}
    button{cursor:pointer;background:#00d4ff;color:#000;font-weight:bold}
    .out{background:#0c1424;padding:8px;margin-top:8px;border-radius:6px;font-size:13px}
    #map{height:100%}
  </style>
</head>
<body>
  <aside>
    <h2>Meteor Madness üåç‚òÑ</h2>
    <label>Select real asteroid (NASA NeoWs)</label>
    <select id="asteroidSelect"><option>Loading...</option></select>
    
    <label>Asteroid diameter (m)</label>
    <input id="inDia" type="number" value="50" />
    
    <label>Speed (km/s)</label>
    <input id="inVel" type="number" value="17" />
    
    <label>Entry angle (¬∞)</label>
    <input id="inAng" type="number" value="45" />
    
    <label>Impact type</label>
    <select id="inType">
      <option value="land">Land</option>
      <option value="ocean">Ocean</option>
    </select>
    
    <button onclick="computeAndDraw()">Run Simulation</button>
    <div class="out" id="out"></div>
  </aside>
  <div id="map"></div>

<script>
const MT_TNT_J = 4.184e15;
const R_EARTH_KM=6371;

let map = L.map('map').setView([23.81,90.41],6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
let marker=L.marker([23.81,90.41]).addTo(map);

let circles={};

function kineticEnergyJ(d_m, v_km_s){
  const r=d_m/2;
  const vol=(4/3)*Math.PI*r**3;
  const mass=3000*vol; // assumed density
  return 0.5*mass*(v_km_s*1000)**2;
}

function effectiveEnergyMt(EJ,angle){
  return (EJ*Math.sin(angle*Math.PI/180))/MT_TNT_J;
}

function damageRadiiKm(E_mt){
  const root=Math.cbrt(E_mt);
  return {sev:3*root, mod:7*root, light:15*root};
}

function drawCircle(key,latlng,r,style){
  if(circles[key]) map.removeLayer(circles[key]);
  circles[key]=L.circle(latlng,{radius:r*1000,...style}).addTo(map);
}

function computeAndDraw(){
  const latlng=marker.getLatLng();
  const d=parseFloat(document.getElementById('inDia').value);
  const v=parseFloat(document.getElementById('inVel').value);
  const a=parseFloat(document.getElementById('inAng').value);
  const type=document.getElementById('inType').value;
  
  const EJ=kineticEnergyJ(d,v);
  const Emt=effectiveEnergyMt(EJ,a);
  const radii=damageRadiiKm(Emt);
  
  drawCircle('sev',latlng,radii.sev,{color:'red',fillColor:'red',fillOpacity:0.2});
  drawCircle('mod',latlng,radii.mod,{color:'orange',fillColor:'orange',fillOpacity:0.15});
  drawCircle('light',latlng,radii.light,{color:'green',fillColor:'green',fillOpacity:0.1});
  
  document.getElementById('out').innerHTML=
    `Energy: ${Emt.toFixed(2)} Mt TNT<br>
     Damage radius: ${radii.light.toFixed(1)} km<br>
     Type: ${type}`;
}

// Fetch NASA NeoWs data
async function loadAsteroids(){
  try{
    const res=await fetch('https://api.nasa.gov/neo/rest/v1/neo/browse?api_key=DEMO_KEY');
    const data=await res.json();
    const select=document.getElementById('asteroidSelect');
    select.innerHTML="";
    
    data.near_earth_objects.slice(0,20).forEach(obj=>{
      const opt=document.createElement('option');
      const d=obj.estimated_diameter.meters.estimated_diameter_max.toFixed(0);
      const v=obj.close_approach_data[0]?.relative_velocity.kilometers_per_second;
      opt.value=JSON.stringify({d:d,v:v});
      opt.textContent=`${obj.name} (D‚âà${d}m, v‚âà${parseFloat(v).toFixed(1)} km/s)`;
      select.appendChild(opt);
    });
    
    select.addEventListener('change',()=>{
      const val=JSON.parse(select.value);
      document.getElementById('inDia').value=val.d;
      document.getElementById('inVel').value=parseFloat(val.v).toFixed(1);
    });
  }catch(e){console.error(e);}
}
loadAsteroids();
</script>
</body>
</html>
